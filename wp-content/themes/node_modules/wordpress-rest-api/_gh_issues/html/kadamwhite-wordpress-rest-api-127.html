<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script type="text/javascript" src="lib/jquery.js"></script>
    <script type="text/javascript" src="lib/jquery.emoji.js"></script>
    <title>Determine how to handle embedded responses</title>
  </head>
  <body>
    <div class="container">
      <header>
        <p>
          <span class="badge open">open</span>
          <span class="url">kadamwhite/wordpress-rest-api#127</span>
        </p>
        <h1>Determine how to handle embedded responses</h1>
      </header>
      <div class="comments">
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/kadamwhite">kadamwhite</a>
            <time>1/21/2016</time>
          </div>
          <div class="body">
            <p>When you make a request like <code>wp.posts().id( 42 ).embed()</code>, the returned JSON object will exactly mirror the API response you would get in the browser: that is to say, the response object will have an <code>._embedded: {}</code> object containing arrays of the embedded versions of linked author, media, and taxonomy term, etc resources.</p>
<p>There are two (and a half) ways we could proceed:</p>
<p><strong>1:</strong> Leave <code>_embedded</code> the way it is, do not mutate the response object in any way</p>
<p><strong>2:</strong> Mutate the response object to in-line the contents of <code>_embedded</code> into the response, so that e.g. instead of</p>
<pre><code class="lang-js">{
  // ...
  author: 3,
  _embedded: {
    author: [ {
      id: 3,
      name: &#39;Muscles McTouchdown&#39;,
      // ...
    }]
  }
}
</code></pre>
<p>you would get simply</p>
<pre><code class="lang-js">{
  // ...
  author: {
    id: 3,
    name: &#39;Muscles McTouchdown&#39;,
    // ...
  }
}
</code></pre>
<p>This has the advantage of &quot;shielding&quot; the user from the nuances of embedded data, and they can easily determine whether they&#39;ve got embedded data or not by <em>e.g.</em> inspecting the <code>typeof post.author</code>. That could be considered a downside as well.</p>
<p><strong>2.5:</strong> Implement some standardized way of defining post transformations, and make this configurable. I&#39;m not 100% sure I&#39;m comfortable heading down that road yet (it was previously discussed and back-burnered way back in #5) but it <em>would</em> allow users to pick their own poison, at the expense of increasing library complexity.</p>
<p>Opinions welcome!</p>

          </div>
        </div>

        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/kadamwhite">
              kadamwhite
            </a>
            <time>1/21/2016</time>
          </div>
          <div class="body"><p>cc @tkellen as I know you in particular have talked through these questions with regard to JSON API: WP-API doesn&#39;t conform to that standard but I&#39;m curious how you all handled embedding.</p>
</div>
        </div>
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/artoliukkonen">
              artoliukkonen
            </a>
            <time>1/29/2016</time>
          </div>
          <div class="body"><p>I&#39;d personally like <strong>2</strong> the most, since this is the way many other similar APIs work (Facebook, Contentful, etc). </p>
</div>
        </div>
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/kadamwhite">
              kadamwhite
            </a>
            <time>1/29/2016</time>
          </div>
          <div class="body"><p>After discussion with @artoliukkonen, @nb, @adamsilverstein &amp; others at the <a href="">Day of REST hack day</a>, this is the proposed implementation:</p>
<p>Within WPRequest, specifically the <code>returnBody</code> method, pass the response body (if object) or response collection members (if array) through a transformation function (defaults to identity function). Provide an interface to specify a function to use at this step. Provide a method that could be used to inline values as described in <strong>2</strong>, above, as an opt-in response customization. </p>
</div>
        </div>
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/tkellen">
              tkellen
            </a>
            <time>1/29/2016</time>
          </div>
          <div class="body"><p>@kadamwhite There must be an existing client library that can do this transformation for you? If there isn&#39;t, I would consider writing one completely separate from this lib. Based on my understanding of the purpose of this library I would not expect it to do anything but pass API results back to me unchanged.</p>
<p>If you&#39;re concerned about making things more usable I would solve that problem by providing examples of how to use this other (potentially as-yet-to-be-created) client library to manage that sort of thing.</p>
</div>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      $(document).ready(function(){
        $('.comment').each(function(i, d){
          $(d).emoji()
        })
      })
    </script>

  </body>
</html>
